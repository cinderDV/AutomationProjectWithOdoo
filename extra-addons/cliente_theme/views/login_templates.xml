<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ================================================================== -->
    <!-- NIVEL 2: Personalización de la Pantalla de LOGIN -->
    <!-- NOTA: Las imágenes y textos se configuran desde Ajustes > Cliente Theme -->
    <!-- ================================================================== -->

    <!-- 1. Personalizar el diseño del Login -->
    <template id="custom_login_layout" inherit_id="web.login_layout" name="Custom Login Layout">
        <t t-set="logo_data" t-value="request.env['ir.config_parameter'].sudo().get_param('cliente_theme.backend_logo', False)"/>
        <t t-set="login_title" t-value="request.env['ir.config_parameter'].sudo().get_param('cliente_theme.login_title', 'Bienvenido al ERP')"/>
        <t t-set="login_subtitle" t-value="request.env['ir.config_parameter'].sudo().get_param('cliente_theme.login_subtitle', 'Inicia sesión para continuar')"/>
        <t t-set="primary_color" t-value="request.env['ir.config_parameter'].sudo().get_param('cliente_theme.primary_color', '#1E40AF')"/>
        <t t-set="secondary_color" t-value="request.env['ir.config_parameter'].sudo().get_param('cliente_theme.secondary_color', '#10B981')"/>
        <t t-set="login_bg" t-value="request.env['ir.config_parameter'].sudo().get_param('cliente_theme.login_background', False)"/>

        <!-- Cambiar el logo del login si está configurado -->
        <xpath expr="//div[hasclass('oe_single_form_container')]//img" position="attributes">
            <attribute name="t-if">logo_data</attribute>
            <attribute name="t-att-src">'data:image/png;base64,' + logo_data</attribute>
            <attribute name="style">max-height: 120px; margin-bottom: 30px; object-fit: contain;</attribute>
        </xpath>

        <!-- Agregar texto de bienvenida personalizado -->
        <xpath expr="//div[hasclass('oe_single_form_container')]" position="before">
            <div class="text-center mb-4">
                <h2 t-att-style="'color: ' + primary_color + '; font-weight: 600;'">
                    <t t-esc="login_title"/>
                </h2>
                <p style="color: #6c757d;">
                    <t t-esc="login_subtitle"/>
                </p>
            </div>
        </xpath>

        <!-- Cambiar el fondo de la pantalla de login -->
        <xpath expr="//body" position="attributes">
            <attribute name="t-att-style">
                'background: ' + (
                    ('url(data:image/jpeg;base64,' + login_bg + ') center/cover fixed, ') if login_bg else ''
                ) + 'linear-gradient(135deg, ' + primary_color + ' 0%, ' + secondary_color + ' 100%);'
            </attribute>
        </xpath>
    </template>

    <!-- 2. Personalizar el formulario de login -->
    <template id="custom_login_form" inherit_id="web.login" name="Custom Login Form">
        <t t-set="primary_color" t-value="request.env['ir.config_parameter'].sudo().get_param('cliente_theme.primary_color', '#1E40AF')"/>

        <!-- Estilizar el botón de login con color primario -->
        <xpath expr="//button[@type='submit']" position="attributes">
            <attribute name="class">btn btn-primary btn-lg btn-block</attribute>
            <attribute name="t-att-style">
                'background-color: ' + primary_color + ' !important; border: none; border-radius: 8px; padding: 12px; font-weight: 600; margin-top: 20px;'
            </attribute>
        </xpath>

        <!-- Estilizar los campos de input -->
        <xpath expr="//input[@name='login']" position="attributes">
            <attribute name="class">form-control form-control-lg</attribute>
            <attribute name="placeholder">Correo electrónico</attribute>
            <attribute name="style">border-radius: 8px; padding: 12px;</attribute>
        </xpath>

        <xpath expr="//input[@name='password']" position="attributes">
            <attribute name="class">form-control form-control-lg</attribute>
            <attribute name="placeholder">Contraseña</attribute>
            <attribute name="style">border-radius: 8px; padding: 12px;</attribute>
        </xpath>
    </template>

    <!-- 3. Agregar footer personalizado al login -->
    <template id="custom_login_footer" inherit_id="web.login_layout" name="Custom Login Footer">
        <t t-set="footer_text" t-value="request.env['ir.config_parameter'].sudo().get_param('cliente_theme.footer_text', '© 2025 Tu Empresa - Todos los derechos reservados')"/>

        <xpath expr="//div[hasclass('oe_single_form_container')]" position="after">
            <div class="text-center mt-5" style="color: white;">
                <p style="font-size: 14px; margin-bottom: 5px;">
                    ¿Problemas para acceder?
                    <a href="mailto:soporte@tuempresa.com" style="color: #FCD34D; text-decoration: underline;">
                        Contacta a soporte
                    </a>
                </p>
                <p style="font-size: 12px; opacity: 0.8;">
                    <t t-esc="footer_text"/>
                </p>
            </div>
        </xpath>
    </template>

</odoo>
